# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–ª–∞—Å—Å—ã
import telegram
from telegram.ext import Updater, CommandHandler, MessageHandler, Filters, CallbackQueryHandler
import random # –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ª—É—á–∞–π–Ω—ã—Ö —á–∏—Å–µ–ª
import logging
import pandas as pd
import datetime

# –°–æ–∑–¥–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–æ–º–µ—Ä–∞ –Ω–µ–¥–µ–ª–∏
last_week = -1

# –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç Updater —Å —Ç–æ–∫–µ–Ω–æ–º –Ω–∞—à–µ–≥–æ –±–æ—Ç–∞
updater = Updater('5925395963:AAEtt0-hzK9eZzChdP3adjERC-_jpA3ktT8', use_context=True)

# –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç Dispatcher
dispatcher = updater.dispatcher

# –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ Excel —Ñ–∞–π–ª–∞ –≤ DataFrame
df = pd.read_excel('example.xlsx')

# –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é —Å—Ç—Ä–æ–∫—É –∏–∑ –ø–µ—Ä–≤–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞ DataFrame
def get_random_horoscope():
    # –∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞ csv
    df = pd.read_excel('example.xlsx', header=None)
    # –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å —Å–ª—É—á–∞–π–Ω—ã–π –≥–æ—Ä–æ—Å–∫–æ–ø –∏–∑ –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–∞
    row_number = random.randint(0, len(df) - 1)
    # –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ row_number –Ω–µ –±–æ–ª—å—à–µ, —á–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –≤ df
    if row_number >= len(df):
        row_number = len(df) - 1
    return df.iloc[row_number, 0]



# –°–æ–∑–¥–∞–µ–º —Å–ø–∏—Å–æ–∫ –≥–æ—Ä–æ—Å–∫–æ–ø–æ–≤ –Ω–∞ –Ω–µ–¥–µ–ª—é –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–Ω–∞–∫–∞ –∑–æ–¥–∏–∞–∫–∞
horoscopes = {
    '–æ–≤–µ–Ω': [
        '*‚ôàÔ∏è –û–≤–µ–Ω*\n\n'+get_random_horoscope()
    ],
    '—Ç–µ–ª–µ—Ü': [
        '*‚ôâÔ∏è –¢–µ–ª–µ—Ü*\n\n'+get_random_horoscope()
    ],
    '–±–ª–∏–∑–Ω–µ—Ü—ã': [
        '*‚ôäÔ∏è –ë–ª–∏–∑–Ω–µ—Ü—ã*\n\n'+get_random_horoscope()
    ],
    '—Ä–∞–∫': [
        '*‚ôãÔ∏è –†–∞–∫*\n\n'+get_random_horoscope()
    ],
    '–ª–µ–≤': [
        '*‚ôåÔ∏è –õ–µ–≤*\n\n'+get_random_horoscope()
    ],
    '–¥–µ–≤–∞': [
        '*‚ôçÔ∏è –î–µ–≤–∞*\n\n'+get_random_horoscope()
    ],
    '–≤–µ—Å—ã': [
        '*‚ôéÔ∏è –í–µ—Å—ã*\n\n'+get_random_horoscope()
    ],
    '—Å–∫–æ—Ä–ø–∏–æ–Ω': [
        '*‚ôèÔ∏è –°–∫–æ—Ä–ø–∏–æ–Ω*\n\n'+get_random_horoscope()
    ],
    '—Å—Ç—Ä–µ–ª–µ—Ü': [
        '*‚ôêÔ∏è –°—Ç—Ä–µ–ª–µ—Ü*\n\n'+get_random_horoscope()
    ],
    '–∫–æ–∑–µ—Ä–æ–≥': [
        '*‚ôëÔ∏è –ö–æ–∑–µ—Ä–æ–≥*\n\n'+get_random_horoscope()
    ],
    '–≤–æ–¥–æ–ª–µ–π': [
        '*‚ôíÔ∏è –í–æ–¥–æ–ª–µ–π*\n\n'+get_random_horoscope()
    ],
    '—Ä—ã–±–∞': [
        '*‚ôìÔ∏è –†—ã–±—ã*\n\n'+get_random_horoscope()
    ]
}


# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫
logging.basicConfig(filename='errors.log', level=logging.ERROR, format='%(asctime)s %(levelname)s %(module)s %(funcName)s %(lineno)d %(message)s')

def handle_exceptions(func):
    def wrapper(update, context):
        try:
            return func(update, context)
        except Exception as e:
            # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏
            error_message = '*–£–ø—Å... —É –Ω–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞... ü§ñ*\n\n–ú—ã –±–æ—Ç—ã, –Ω–æ –¥–∞–∂–µ –º—ã –Ω–µ –≤—Å–µ–≥–¥–∞ –∏–¥–µ–∞–ª—å–Ω—ã! –ù–æ –Ω–µ —Ä–∞—Å—Å—Ç—Ä–∞–∏–≤–∞–π—Ç–µ—Å—å, –ø–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ–º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ —Å–≤–æ–π –∑–∞–ø—Ä–æ—Å. –ê –º–æ–∂–µ—Ç, –ø–æ–∫–∞ –º—ã –∑–¥–µ—Å—å —É—Å—Ç—Ä–∞–Ω—è–µ–º –Ω–µ–ø–æ–ª–∞–¥–∫–∏, –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ø–∏—Ç—å —á–∞—é –∏–ª–∏ —Å—ä–µ—Å—Ç—å —á—Ç–æ-–Ω–∏–±—É–¥—å –≤–∫—É—Å–Ω–µ–Ω—å–∫–æ–µ? –í—Å—ë –Ω–∞–ª–∞–¥–∏—Ç—Å—è, –º—ã –æ–±–µ—â–∞–µ–º!'
            context.bot.send_message(chat_id=update.effective_chat.id, text=error_message, parse_mode="Markdown")
            logging.error(f'–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã {func.__name__}: {e}', exc_info=True)
    return wrapper


# –°–æ–∑–¥–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –∫–∞–Ω–∞–ª
@handle_exceptions
def check_subscription(update, context):
    # –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–¥–ø–∏—Å–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    channels = context.bot.get_chat_member('@dusha_star', update.effective_chat.id)
    # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ –∫–∞–Ω–∞–ª, —Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º True
    if channels.status in ['creator', 'administrator', 'member']:
        print("–î–∞")
        return True
    # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ –∫–∞–Ω–∞–ª, —Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º False
    else:
        print("–ù–µ—Ç")
        return False


# –°–æ–∑–¥–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞ message
global message

# –°–æ–∑–¥–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø—Ä–æ—Å—å–±–æ–π –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª
@handle_exceptions
def send_subscription_request(update, context):
    # –°–æ–∑–¥–∞–µ–º inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –¥–≤—É–º—è –∫–Ω–æ–ø–∫–∞–º–∏ - –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –∏ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏
    keyboard = telegram.InlineKeyboardMarkup([[telegram.InlineKeyboardButton('–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è ‚úÖ', url='https://t.me/dusha_star')], [telegram.InlineKeyboardButton('–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ üîç', callback_data='check_subscription')]])
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –µ–≥–æ –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é message
    global message
    message = context.bot.send_message(chat_id=update.effective_chat.id, text='*–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é —Ç–µ–±—è, –ø—É—Ç–Ω–∏–∫!* üôã‚Äç‚ôÇÔ∏è\n\n–¢—ã –ø–æ–ø–∞–ª –≤ –º–∏—Ä –∞—Å—Ç—Ä–æ–ª–æ–≥–∏–∏, –≥–¥–µ —è, —Ç–≤–æ–π –≤–µ—Ä–Ω—ã–π –ê—Å—Ç—Ä–æ–±–æ—Ç, –º–æ–≥—É –ø—Ä–∏—Å–ª–∞—Ç—å —Ç–µ–±–µ –≥–æ—Ä–æ—Å–∫–æ–ø –Ω–∞ –Ω–µ–¥–µ–ª—é –ø–æ —Ç–≤–æ–µ–º—É –∑–Ω–∞–∫—É –∑–æ–¥–∏–∞–∫–∞.\n\n–ù–æ –ø—Ä–µ–∂–¥–µ —á–µ–º –º—ã –Ω–∞—á–Ω–µ–º –Ω–∞—à–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ, —è –ø—Ä–æ—à—É —Ç–µ–±—è —Å–¥–µ–ª–∞—Ç—å –æ–¥–Ω–æ –º–∞–ª–µ–Ω—å–∫–æ–µ –¥–µ–ª–æ - –ø–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ –∫–∞–Ω–∞–ª "–ó–≤—ë–∑–¥—ã –≤ –¥—É—à–µ" –∏ –ø–æ–ª—É—á–∏ –¥–æ—Å—Ç—É–ø –∫ –º—É–¥—Ä–æ—Å—Ç–∏ –∑–≤–µ–∑–¥! ‚ú®', reply_markup=keyboard, parse_mode="Markdown")


# –°–æ–∑–¥–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞–∂–∞—Ç–∏–π –Ω–∞ inline –∫–Ω–æ–ø–∫–∏
@handle_exceptions
def callback(update, context):
    # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ callback_query
    query = update.callback_query
    # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª –Ω–∞ –∫–Ω–æ–ø–∫—É –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏, —Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–¥–ø–∏—Å–∞–Ω –ª–∏ –æ–Ω –Ω–∞ –∫–∞–Ω–∞–ª
    if query.data == 'check_subscription':
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–¥–ø–∏—Å–∞–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ –∫–∞–Ω–∞–ª
        if check_subscription(update, context):
            # –ï—Å–ª–∏ –ø–æ–¥–ø–∏—Å–∞–Ω, —Ç–æ –∏–∑–º–µ–Ω—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç–∞ —Å –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å—é –∑–∞ –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ –∫–∞–Ω–∞–ª
            # –î–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é message
            global message
            # –ò–∑–º–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –±–æ—Ç–∞ —Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–∞ bot.edit_message_text
            # –ü–µ—Ä–µ–¥–∞–µ–º –µ–º—É –ø–∞—Ä–∞–º–µ—Ç—Ä—ã chat_id, message_id –∏ text
            context.bot.edit_message_text(chat_id=message.chat_id,
                                          message_id=message.message_id,
                                          text='*–°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–¥–ø–∏—Å–∫—É*üôè\n\n–¢–µ–ø–µ—Ä—å —Ç—ã –º–æ–∂–µ—à—å –ø–æ–ª—É—á–∞—Ç—å –≥–æ—Ä–æ—Å–∫–æ–ø –Ω–∞ –Ω–µ–¥–µ–ª—é –ø–æ —Ç–≤–æ–µ–º—É –∑–Ω–∞–∫—É –∑–æ–¥–∏–∞–∫–∞. –î–ª—è —ç—Ç–æ–≥–æ –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏ –º–Ω–µ —Å–≤–æ–π –∑–Ω–∞–∫ –≤ —á–∞—Ç–µ. –ù–∞–ø—Ä–∏–º–µ—Ä, "–û–≤–µ–Ω" –∏–ª–∏ "–í–µ—Å—ã".\n\n–ñ–µ–ª–∞—é —Ç–µ–±–µ —É–¥–∞—á–∏ –∏ —Å—á–∞—Å—Ç—å—è! ‚ú®', parse_mode="Markdown")
        else:
            # –ï—Å–ª–∏ –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω, —Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –µ–º—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —ç—Ç–æ–º
            context.bot.answer_callback_query(query.id, '–¢—ã –µ—â–µ –Ω–µ –ø–æ–¥–ø–∏—Å–∞–ª—Å—è –Ω–∞ —Ç–µ–ª–µ–≥—Ä–∞–º –∫–∞–Ω–∞–ª! üòû')


# –°–æ–∑–¥–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å—é –∑–∞ –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ –∫–∞–Ω–∞–ª
@handle_exceptions
def send_subscription_thanks(message):
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å—é
    print("–Ø —Ç—É—Ç")
    message.reply_text('–°–ø–∞—Å–∏–±–æ, —á—Ç–æ –ø–æ–¥–ø–∏—Å–∞–ª—Å—è –Ω–∞ –∫–∞–Ω–∞–ª "–ó–≤—ë–∑–¥—ã –≤ –¥—É—à–µ"! üôè\n\n–¢–µ–ø–µ—Ä—å —Ç—ã –º–æ–∂–µ—à—å –ø–æ–ª—É—á–∞—Ç—å –≥–æ—Ä–æ—Å–∫–æ–ø –Ω–∞ –Ω–µ–¥–µ–ª—é –ø–æ —Ç–≤–æ–µ–º—É –∑–Ω–∞–∫—É –∑–æ–¥–∏–∞–∫–∞. –î–ª—è —ç—Ç–æ–≥–æ –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏ –º–Ω–µ —Å–≤–æ–π –∑–Ω–∞–∫ –≤ —á–∞—Ç–µ. –ù–∞–ø—Ä–∏–º–µ—Ä, "–û–≤–µ–Ω" –∏–ª–∏ "–í–µ—Å—ã".\n\n–ñ–µ–ª–∞—é —Ç–µ–±–µ —É–¥–∞—á–∏ –∏ —Å—á–∞—Å—Ç—å—è! ‚ú®', parse_mode="Markdown")

# –°–æ–∑–¥–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥—ã /start
@handle_exceptions
def start(update, context):
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–¥–ø–∏—Å–∞–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ –∫–∞–Ω–∞–ª
    if check_subscription(update, context):
        # –ï—Å–ª–∏ –ø–æ–¥–ø–∏—Å–∞–Ω, —Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –µ–º—É –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–µ–∑ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
        context.bot.send_message(update.effective_chat.id, '*–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π, –ø—É—Ç–Ω–∏–∫!* üôã‚Äç‚ôÇÔ∏è\n\n–Ø —Ç–≤–æ–π –ê—Å—Ç—Ä–æ–±–æ—Ç, –∏ —è –º–æ–≥—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å —Ç–µ–±–µ –≥–æ—Ä–æ—Å–∫–æ–ø –Ω–∞ –Ω–µ–¥–µ–ª—é –ø–æ —Ç–≤–æ–µ–º—É –∑–Ω–∞–∫—É –∑–æ–¥–∏–∞–∫–∞.\n\n–ù–∞–ø–∏—à–∏ —Å–≤–æ–π –∑–Ω–∞–∫ –∑–æ–¥–∏–∞–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –†–∞–∫) –∏ —è –æ—Ç–≤–µ—á—É —Ç–µ–±–µ –≥–æ—Ä–æ—Å–∫–æ–ø–æ–º –Ω–∞ –Ω–µ–¥–µ–ª—é!', parse_mode="Markdown")
    else:
        # –ï—Å–ª–∏ –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω, —Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –µ–º—É —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–æ—Å—å–±–æ–π –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª
        send_subscription_request(update, context)


# –°–æ–∑–¥–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
@handle_exceptions
def text(update, context):
    global last_week
    global last_day
    # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    keyboard = telegram.InlineKeyboardMarkup([[telegram.InlineKeyboardButton('–ü–æ—Å–µ—Ç–∏—Ç—å –∫–∞–Ω–∞–ª üí´', url='https://t.me/dusha_star')]])
    keyboard2 = telegram.InlineKeyboardMarkup([[telegram.InlineKeyboardButton('–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –≥–æ—Ä–æ—Å–∫–æ–ø ‚ú®', url='https://t.me/dusha_star')]])
    text = update.effective_message.text
    whoIam = "*–ë–∏–ø...–ü—É–ø... –ö—Ç–æ...–Ø? ü§ñ*\n\n–Ø —Ç–≤–æ–π –ê—Å—Ç—Ä–æ–±–æ—Ç! –í—Å–µ–≥–¥–∞ –≥–æ—Ç–æ–≤ –Ω–∞–ø–∏—Å–∞—Ç—å –≥–æ—Ä–æ—Å–∫–æ–ø –Ω–∞ –≤—Å—é –Ω–µ–¥–µ–ª—é! –ù–æ –ø–æ–º–Ω–∏, —á—Ç–æ —è –≤—Å–µ–≥–æ –ª–∏—à—å –º–∞—à–∏–Ω–∞, —Ö–æ—Ç—å –∏ –æ—á–µ–Ω—å —É–º–Ω–∞—è. –ü–∏—à–∏ —Å–≤–æ–π –∑–Ω–∞–∫ –∑–æ–¥–∏–∞–∫–∞, –∞ —è –ø—Ä–∏—à–ª—é —Ç–µ–±–µ –≥–æ—Ä–æ—Å–∫–æ–ø!\n\n–ï—Å–ª–∏ —Ç–µ–±–µ –Ω—É–∂–Ω–∞ —Ç—ë–ø–ª–∞—è –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞ –∏ –æ–±—â–µ–Ω–∏–µ —Å –Ω–∞—Å—Ç–æ—è—â–∏–º–∏ –ª—é–¥—å–º–∏, —Ç–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –∑–∞–π—Ç–∏ –≤ –Ω–∞—à —Ç–µ–ª–µ–≥—Ä–∞–º –∫–∞–Ω–∞–ª. –¢–∞–º –ø—É–±–ª–∏–∫—É—é—Ç—Å—è –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –≥–æ—Ä–æ—Å–∫–æ–ø—ã –∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–µ–π—à–∏–µ –ø–æ—Å—Ç—ã. –ü–æ–¥–ø–∏—Å—ã–≤–∞–π—Å—è –∏ –±—É–¥—å –≤ –∫—É—Ä—Å–µ –≤—Å–µ—Ö –∑–≤—ë–∑–¥–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π!"
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–¥–ø–∏—Å–∞–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ –∫–∞–Ω–∞–ª
    if check_subscription(update, context):
        # –ï—Å–ª–∏ –ø–æ–¥–ø–∏—Å–∞–Ω, —Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞–ø–∏—Å–∞–ª –ª–∏ –æ–Ω —Å–≤–æ–π –∑–Ω–∞–∫ –∑–æ–¥–∏–∞–∫–∞
        if text.lower() in horoscopes:
            # –°–æ–∑–¥–∞–µ–º —Å–ø–∏—Å–æ–∫ –≥–æ—Ä–æ—Å–∫–æ–ø–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–Ω–∞–∫–∞ –∑–æ–¥–∏–∞–∫–∞
            sign_emojis = {
                '–æ–≤–µ–Ω': '‚ôàÔ∏è',
                '—Ç–µ–ª–µ—Ü': '‚ôâÔ∏è',
                '–±–ª–∏–∑–Ω–µ—Ü—ã': '‚ôäÔ∏è',
                '—Ä–∞–∫': '‚ôãÔ∏è',
                '–ª–µ–≤': '‚ôåÔ∏è',
                '–¥–µ–≤–∞': '‚ôçÔ∏è',
                '–≤–µ—Å—ã': '‚ôéÔ∏è',
                '—Å–∫–æ—Ä–ø–∏–æ–Ω': '‚ôèÔ∏è',
                '—Å—Ç—Ä–µ–ª–µ—Ü': '‚ôêÔ∏è',
                '–∫–æ–∑–µ—Ä–æ–≥': '‚ôëÔ∏è',
                '–≤–æ–¥–æ–ª–µ–π': '‚ôíÔ∏è',
                '—Ä—ã–±–∞': '‚ôìÔ∏è'
            }

            # –°–æ–∑–¥–∞–µ–º —Å–ø–∏—Å–æ–∫ –≥–æ—Ä–æ—Å–∫–æ–ø–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–Ω–∞–∫–∞ –∑–æ–¥–∏–∞–∫–∞
            for sign in sign_emojis:
                horoscopes[sign] = [
                    f'*{sign_emojis[sign]} {sign.capitalize()}*\n\n{get_random_horoscope()}'
                ]
            # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π –Ω–æ–º–µ—Ä –Ω–µ–¥–µ–ª–∏
            today_week = datetime.datetime.now().isocalendar()[1]

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏–∑–º–µ–Ω–∏–ª—Å—è –ª–∏ –Ω–æ–º–µ—Ä –Ω–µ–¥–µ–ª–∏ - –¢–æ –µ—Å—Ç—å –µ—Å–ª–∏ 28 –Ω–µ–¥–µ–ª—è –Ω–µ —Ä–∞–≤–Ω–∞ 29(–¢–æ –µ—Å—Ç—å –∫–∞–∫ –±—ã –ø—Ä–æ—à–ª–∞ —É–∂–µ –Ω–µ–¥–µ–ª—è), —Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º
            if today_week != last_week or text.lower() not in context.user_data.get('znak', []):
                # –ï—Å–ª–∏ –¥–∞, —Ç–æ –≤—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –≥–æ—Ä–æ—Å–∫–æ–ø –∏–∑ —Å–ø–∏—Å–∫–∞ –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –∑–Ω–∞–∫–∞ –∑–æ–¥–∏–∞–∫–∞
                horoscope = random.choice(horoscopes[text.lower()])
                # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≥–æ—Ä–æ—Å–∫–æ–ø
                context.bot.send_message(update.effective_chat.id, horoscope+"\n\n–ù–æ –ø–æ–º–Ω–∏—Ç–µ, —á—Ç–æ –∑–≤–µ–∑–¥—ã –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –ø—Ä–∏–Ω–æ—Å—è—Ç –Ω–æ–≤—ã–µ –≤—ã–∑–æ–≤—ã –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏. –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∑–Ω–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–π –≥–æ—Ä–æ—Å–∫–æ–ø –Ω–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å, —Ç–æ –∑–∞—Ö–æ–¥–∏—Ç–µ –≤ –Ω–∞—à —Ç–µ–ª–µ–≥—Ä–∞–º –∫–∞–Ω–∞–ª –ø–æ—á–∞—â–µ!\n\n–ö–Ω–æ–ø–æ—á–∫–∞ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤–Ω–∏–∑—É ‚§µÔ∏è", parse_mode="Markdown", reply_markup=keyboard2)

                #–¢–æ –µ—Å—Ç—å –∫–∞–∫ –±—ã –µ—Å–ª–∏ –ø—Ä–æ—à–ª–∞ –Ω–µ–¥–µ–ª—è, —Ç–æ –µ—Å—Ç—å 28 –Ω–µ–¥–µ–ª—è –Ω–µ —Ä–∞–≤–Ω–∞ 29, —Ç–æ –æ—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫!
                if today_week != last_week:
                    # –ï—Å–ª–∏ –¥–∞, —Ç–æ –æ—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫ znak –≤ context.user_data
                    context.user_data['znak'] = []
                # –î–æ–±–∞–≤–ª—è–µ–º –∑–Ω–∞–∫ –∑–æ–¥–∏–∞–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–ø–∏—Å–æ–∫ znak –≤ context.user_data
                if 'znak' not in context.user_data:
                    # –ï—Å–ª–∏ –∫–ª—é—á–∞ 'znak' –Ω–µ—Ç –≤ context.user_data, —Ç–æ —Å–æ–∑–¥–∞–µ–º –µ–≥–æ –∏ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º –µ–º—É –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫
                    context.user_data['znak'] = []
                context.user_data['znak'].append(text.lower())
                print(context.user_data['znak'])

                # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π –Ω–æ–º–µ—Ä –Ω–µ–¥–µ–ª–∏ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
                last_week = today_week

            else:
                znaki_zodiaka = {
                    '–æ–≤–µ–Ω': '*"–û–≤–Ω–∞"*',
                    '—Ç–µ–ª–µ—Ü': '*"–¢–µ–ª—å—Ü–∞"*',
                    '–±–ª–∏–∑–Ω–µ—Ü—ã': '*"–ë–ª–∏–∑–Ω–µ—Ü–∞"*',
                    '—Ä–∞–∫': '*"–†–∞–∫–∞"*',
                    '–ª–µ–≤': '*"–õ—å–≤–∞"*',
                    '–¥–µ–≤–∞': '*"–î–µ–≤—ã"*',
                    '–≤–µ—Å—ã': '*"–í–µ—Å–æ–≤"*',
                    '—Å–∫–æ—Ä–ø–∏–æ–Ω': '*"–°–∫–æ—Ä–ø–∏–æ–Ω–∞"*',
                    '—Å—Ç—Ä–µ–ª–µ—Ü': '*"–°—Ç—Ä–µ–ª—å—Ü–∞"*',
                    '–∫–æ–∑–µ—Ä–æ–≥': '*"–ö–æ–∑–µ—Ä–æ–≥–∞"*',
                    '–≤–æ–¥–æ–ª–µ–π': '*"–í–æ–¥–æ–ª–µ—è"*',
                    '—Ä—ã–±–∞': '*"–†—ã–±—ã"*'
                }

                # –ó–∞–¥–∞–µ–º –∏—Å–∫–æ–º—ã–π –∫–ª—é—á
                key = text.lower()

                # –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ –∫–ª—é—á—É, –∏—Å–ø–æ–ª—å–∑—É—è –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —Å–∫–æ–±–∫–∏
                value = znaki_zodiaka[key]
                # –ï—Å–ª–∏ –Ω–µ—Ç, —Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ, —á—Ç–æ –≥–æ—Ä–æ—Å–∫–æ–ø —É–∂–µ –±—ã–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
                context.bot.send_message(update.effective_chat.id, "*–°—Ç–æ–ø, —Å—Ç–æ–ø, —Å—Ç–æ–ø‚Ä¶ *üôÉ\n\n–ù–µ —Ç–æ—Ä–æ–ø–∏—Å—å, –ø—É—Ç–Ω–∏–∫, —Ç—ã —É–∂–µ –∑–Ω–∞–µ—à—å —Å—É–¥—å–±—É –¥–ª—è "+value+" –Ω–∞ —ç—Ç—É –Ω–µ–¥–µ–ª—é. –ù–µ –ø—ã—Ç–∞–π—Å—è –∏–∑–º–µ–Ω–∏—Ç—å –µ–µ, –∞ –ª—É—á—à–µ –ø–æ–¥–≥–æ—Ç–æ–≤—å—Å—è –∫ –Ω–µ–π. –ò–ª–∏ —Ö–æ—á–µ—à—å –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å, —á—Ç–æ –∂–¥–µ—Ç —Ç–≤–æ–∏—Ö –¥—Ä—É–∑–µ–π –ø–æ –∑–Ω–∞–∫–∞–º –∑–æ–¥–∏–∞–∫–∞? –¢–æ–≥–¥–∞ –ø–∏—à–∏ –º–Ω–µ –¥—Ä—É–≥–æ–π –∑–Ω–∞–∫, –∞ –Ω–æ–≤—ã–π –≥–æ—Ä–æ—Å–∫–æ–ø –¥–ª—è —Ç–µ–±—è –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤ –≤ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫!\n\n–ê –ø–æ–∫–∞ —Ç—ã –º–æ–∂–µ—à—å –ø–æ—Å–µ—Ç–∏—Ç—å –Ω–∞—à —Ç–µ–ª–µ–≥—Ä–∞–º –∫–∞–Ω–∞–ª –∏ —É–∑–Ω–∞—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –≥–æ—Ä–æ—Å–∫–æ–ø. –ö–Ω–æ–ø–æ—á–∫–∞ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤–Ω–∏–∑—É ‚§µÔ∏è", reply_markup=keyboard2, parse_mode="Markdown")
        elif "–∫—Ç–æ —Ç—ã" in text.lower():
            context.bot.send_message(update.effective_chat.id, whoIam, parse_mode="Markdown", reply_markup=keyboard)
        elif "—Ç—ã –∫—Ç–æ" in text.lower():
            context.bot.send_message(update.effective_chat.id, whoIam, parse_mode="Markdown", reply_markup=keyboard)
        elif text.lower() == "/start":
            start(update, context)

        # –ï—Å–ª–∏ –Ω–∞–ø–∏—Å–∞–ª —á—Ç–æ-—Ç–æ –¥—Ä—É–≥–æ–µ, —Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –µ–º—É —Å–æ–æ–±—â–µ–Ω–∏–µ, —á—Ç–æ –º—ã –Ω–µ –ø–æ–Ω–∏–º–∞–µ–º –µ–≥–æ
        else:
            context.bot.send_message(update.effective_chat.id,
                                     '*–ü—Ä–æ—Å—Ç–∏, –ø—É—Ç–Ω–∏–∫, —è –Ω–µ –ø–æ–Ω–∏–º–∞—é —Ç–µ–±—è* ü§∑‚Äç‚ôÇÔ∏è\n\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞–ø–∏—à–∏ —Å–≤–æ–π –∑–Ω–∞–∫ –∑–æ–¥–∏–∞–∫–∞!',
                                     parse_mode="Markdown")

    else:
        # –ï—Å–ª–∏ –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω, —Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –µ–º—É —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–æ—Å—å–±–æ–π –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª
        send_subscription_request(update, context)


# –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è callback-—Ñ—É–Ω–∫—Ü–∏–∏
dispatcher.add_handler(CallbackQueryHandler(callback))

# –î–æ–±–∞–≤–ª—è–µ–º MessageHandler –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
dispatcher.add_handler(MessageHandler(Filters.text, text))

# –î–æ–±–∞–≤–ª—è–µ–º CommandHandler –¥–ª—è –∫–æ–º–∞–Ω–¥—ã /start
dispatcher.add_handler(CommandHandler("start", start))

# –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
updater.start_polling()

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–æ—Ç–∞ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ Ctrl+C
updater.idle()
